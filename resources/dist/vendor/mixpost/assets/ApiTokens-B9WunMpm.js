import{r as g,s as O,c as i,o,a as l,b as s,w as a,d as n,g as x,F as f,e as y,t as u,k as b,p as w,v as C,N as T}from"./app-nhqBUuXa.js";import{_ as S}from"./PageHeader-BPr7WEN0.js";import{_ as q}from"./Panel-BEVhPoT7.js";import{_ as v}from"./PrimaryButton-CCqP81Wf.js";import{_ as M}from"./DangerButton-CgEaUCP3.js";import{_ as $}from"./Badge-C2jtkpf5.js";import{a as R}from"./DialogModal-6UTChQ19.js";import{_ as V}from"./Checkbox-BVww5Q3I.js";import{_ as z}from"./NoResult-B9M6faqa.js";import{_ as B}from"./Alert-ChuXfRfx.js";import"./PureButton-lzmho2OA.js";const D={class:"row-py"},E={key:0,class:"divide-y divide-gray-200 dark:divide-gray-700"},L={class:"flex items-start justify-between"},X={class:"flex items-center gap-2 mb-1"},H={class:"font-medium text-gray-900 dark:text-gray-100"},U={class:"text-sm text-gray-500 font-mono"},J={class:"flex flex-wrap gap-1 mt-2"},K={class:"text-xs text-gray-400 mt-2"},W={key:0},Y={key:1},G={class:"flex items-center gap-2"},Q={class:"bg-gray-100 dark:bg-gray-800 p-4 rounded font-mono text-sm break-all"},Z={key:1,class:"space-y-4"},ee={class:"space-y-2"},te={class:"text-sm text-gray-600 dark:text-gray-400"},fe={__name:"ApiTokens",props:{tokens:Array,available_abilities:Object},setup(p){const A=p,_=g(!1),m=g(null),r=O({name:"",abilities:[],expires_at:""}),h=()=>{r.name="",r.abilities=Object.keys(A.available_abilities||{}),r.expires_at=""},N=()=>{h(),m.value=null,_.value=!0},P=async()=>{var c,e;try{const t=((c=document.querySelector('meta[name="csrf-token"]'))==null?void 0:c.content)||((e=document.querySelector('input[name="_token"]'))==null?void 0:e.value)||"",d=await fetch("/mixpost/api-tokens",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(r)});if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);const k=await d.json();k.success&&(m.value=k.token,T.reload({only:["tokens"]}))}catch(t){console.error("Failed to create token:",t),alert("Failed to create token. Please try again.")}},j=()=>{navigator.clipboard.writeText(m.value),alert("Token copied to clipboard!")},F=c=>{confirm("Delete this API token? This cannot be undone.")&&T.delete(route("mixpost.apiTokens.destroy",c.id))},I=c=>{const e=r.abilities.indexOf(c);e>-1?r.abilities.splice(e,1):r.abilities.push(c)};return(c,e)=>(o(),i("div",null,[l(S,{title:"API Tokens"},{description:a(()=>e[5]||(e[5]=[n(" Manage API tokens for external integrations ")])),_:1}),s("div",D,[l(q,null,{action:a(()=>[l(v,{size:"sm",onClick:N},{default:a(()=>e[6]||(e[6]=[n(" Create Token ")])),_:1,__:[6]})]),default:a(()=>[p.tokens&&p.tokens.length>0?(o(),i("div",E,[(o(!0),i(f,null,y(p.tokens,t=>(o(),i("div",{key:t.id,class:"py-4"},[s("div",L,[s("div",null,[s("div",X,[s("h3",H,u(t.name),1),l($,{variant:t.is_active?"success":"default",size:"sm"},{default:a(()=>[n(u(t.is_active?"Active":"Revoked"),1)]),_:2},1032,["variant"])]),s("p",U,u(t.masked_token),1),s("div",J,[(o(!0),i(f,null,y(t.abilities,d=>(o(),x($,{key:d,variant:"info",size:"sm"},{default:a(()=>[n(u(d),1)]),_:2},1024))),128))]),s("p",K,[n(" Created "+u(t.created_at)+" • ",1),t.last_used_at?(o(),i("span",W,"Last used "+u(t.last_used_at),1)):(o(),i("span",Y,"Never used")),n(" • "+u(t.logs_count)+" requests ",1)])]),s("div",G,[l(M,{size:"xs",onClick:d=>F(t)},{default:a(()=>e[7]||(e[7]=[n(" Revoke ")])),_:2,__:[7]},1032,["onClick"])])])]))),128))])):(o(),x(z,{key:1},{default:a(()=>e[8]||(e[8]=[n(" No API tokens. Create one to integrate with external services. ")])),_:1,__:[8]}))]),_:1})]),l(R,{show:_.value,onClose:e[4]||(e[4]=t=>!m.value&&(_.value=!1))},{header:a(()=>[n(u(m.value?"Token Created!":"Create API Token"),1)]),body:a(()=>[m.value?(o(),i(f,{key:0},[l(B,{variant:"warning",class:"mb-4"},{default:a(()=>e[9]||(e[9]=[n(" Copy this token now. You won't be able to see it again! ")])),_:1,__:[9]}),s("div",Q,u(m.value),1)],64)):(o(),i("div",Z,[s("div",null,[e[10]||(e[10]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Token Name",-1)),w(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>r.name=t),type:"text",placeholder:"My Integration",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white"},null,512),[[C,r.name]])]),s("div",null,[e[11]||(e[11]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Expires At (optional)",-1)),w(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>r.expires_at=t),type:"date",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white"},null,512),[[C,r.expires_at]])]),s("div",null,[e[12]||(e[12]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Permissions",-1)),s("div",ee,[(o(!0),i(f,null,y(p.available_abilities,(t,d)=>(o(),i("div",{key:d,class:"flex items-center gap-2"},[l(V,{checked:r.abilities.includes(d),onChange:k=>I(d)},null,8,["checked","onChange"]),s("span",te,u(t),1)]))),128))])])]))]),footer:a(()=>[m.value?(o(),i(f,{key:0},[l(b,{onClick:j},{default:a(()=>e[13]||(e[13]=[n("Copy Token")])),_:1,__:[13]}),l(v,{onClick:e[2]||(e[2]=t=>_.value=!1),class:"ml-2"},{default:a(()=>e[14]||(e[14]=[n("Done")])),_:1,__:[14]})],64)):(o(),i(f,{key:1},[l(b,{onClick:e[3]||(e[3]=t=>_.value=!1)},{default:a(()=>e[15]||(e[15]=[n("Cancel")])),_:1,__:[15]}),l(v,{onClick:P,class:"ml-2"},{default:a(()=>e[16]||(e[16]=[n("Create Token")])),_:1,__:[16]})],64))]),_:1},8,["show"])]))}};export{fe as default};
